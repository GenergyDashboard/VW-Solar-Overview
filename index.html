<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VW Solar Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f0f0f;
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }
        
        .animated-sun {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .sun-circle {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 30%, #FFE135, #FFB81C);
            border-radius: 50%;
            position: absolute;
            animation: float 8s ease-in-out infinite;
            box-shadow: 0 0 50px rgba(255, 225, 53, 0.6);
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-15px);
            }
        }
        
        .header h1 {
            font-size: 2.8em;
            margin-bottom: 5px;
            color: #ffffff;
        }
        
        .header p {
            font-size: 1.8em;
            color: #888;
            font-weight: 300;
            letter-spacing: 1px;
            position: relative;
            display: inline-block;
            margin-top: 10px;
        }
        
        .genergy-link {
            text-decoration: none;
            color: inherit;
            cursor: pointer;
        }
        
        .genergy-text {
            background: linear-gradient(90deg, #666 0%, #666 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            font-weight: 500;
        }
        
        .genergy-text::before {
            content: 'Genergy';
            position: absolute;
            left: 0;
            top: 0;
            background: linear-gradient(90deg, #4ade80 0%, #10b981 50%, #22c55e 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            width: 0%;
            overflow: hidden;
            animation: greenSweep 6s ease-in-out infinite;
            filter: drop-shadow(0 0 8px rgba(74, 222, 128, 0.4));
        }
        
        @keyframes greenSweep {
            0%, 100% {
                width: 0%;
            }
            50% {
                width: 100%;
            }
            65% {
                width: 100%;
            }
        }
        
        .last-updated {
            font-size: 0.9em;
            color: #666;
            margin-top: 15px;
        }
        
        .day-selector {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px 20px;
            color: #3b82f6;
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .day-selector label {
            color: #888;
            font-weight: 500;
        }
        
        .day-selector select {
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 8px 12px;
            color: #3b82f6;
            font-size: 0.95em;
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .day-selector select:hover {
            border-color: #3b82f6;
            background: #1a1a1a;
        }
        
        .day-selector select option {
            background: #1a1a1a;
            color: #3b82f6;
        }
        
        .info-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px 20px;
            color: #3b82f6;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-toggle:hover {
            background: #222;
            border-color: #3b82f6;
            transform: translateY(-2px);
        }
        
        .info-panel {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            display: none;
            animation: slideDown 0.3s ease;
        }
        
        .info-panel.show {
            display: block;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .info-panel h2 {
            color: #3b82f6;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
        }
        
        .info-section {
            margin-bottom: 25px;
        }
        
        .info-section h3 {
            color: #60a5fa;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .calculation-item {
            background: #0f0f0f;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 3px solid #3b82f6;
        }
        
        .calculation-item strong {
            color: #3b82f6;
            display: block;
            margin-bottom: 8px;
            font-size: 1.05em;
        }
        
        .calculation-item p {
            color: #aaa;
            line-height: 1.6;
            margin-bottom: 8px;
        }
        
        .formula {
            background: #1a1a1a;
            padding: 10px 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            color: #4ade80;
            margin-top: 8px;
            border: 1px solid #2a2a2a;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #333;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .card:hover {
            background: #222;
            border-color: #555;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.1);
        }
        
        .card-title {
            font-size: 1em;
            color: #888;
            margin-bottom: 15px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .card-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 5px;
        }
        
        .card-value .value-number {
            display: inline;
        }
        
        .card-value .value-unit {
            font-size: 0.5em;
            margin-left: 8px;
            color: #3b82f6;
        }
        
        .env-sections {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1400px) {
            .env-sections {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .env-sections {
                grid-template-columns: 1fr;
            }
        }
        
        .section {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 30px;
            border: 1px solid #333;
        }
        
        .section-title {
            font-size: 1.3em;
            margin-bottom: 25px;
            color: #fff;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-icon {
            font-size: 1.3em;
        }
        
        .env-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .env-item {
            padding: 15px;
            background: #0f0f0f;
            border-radius: 8px;
            border-left: 3px solid #3b82f6;
            position: relative;
            cursor: help;
            transition: all 0.3s ease;
        }
        
        .env-item:hover {
            background: #1a1a1a;
            border-left-color: #60a5fa;
        }
        
        .env-item-label {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .env-item-value {
            font-size: 1.4em;
            font-weight: 700;
            color: #3b82f6;
        }
        
        .tooltip {
            position: absolute;
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%) scale(0.8);
            background: #2a2a2a;
            color: #fff;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.85em;
            line-height: 1.4;
            width: 280px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 1000;
            border: 1px solid #444;
        }
        
        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #2a2a2a;
        }
        
        .tooltip.show {
            opacity: 1;
            transform: translateX(-50%) scale(1);
        }
        
        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 2px;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            width: 0%;
            transition: width 3s linear;
            border-radius: 0 0 0 8px;
        }
        
        .env-item:hover .progress-bar {
            width: 100%;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #888;
            font-size: 1.2em;
        }
        
        .error {
            background: #2a1a1a;
            color: #ff6b6b;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
            border: 1px solid #5a2a2a;
        }
        
        @media (max-width: 768px) {
            .day-selector {
                position: static;
                margin: 0 auto 20px;
                width: fit-content;
                flex-direction: column;
                gap: 8px;
            }
            
            .info-toggle {
                position: static;
                margin: 0 auto 20px;
                width: fit-content;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .header p {
                font-size: 1.3em;
            }
            
            .animated-sun {
                width: 60px;
                height: 60px;
            }
            
            .sun-circle {
                width: 60px;
                height: 60px;
            }
            
            .tooltip {
                width: 220px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="day-selector">
            <label for="daySelect">📅 Select Day:</label>
            <select id="daySelect" onchange="handleDayChange()">
                <option value="">Choose a day...</option>
            </select>
        </div>
        
        <button class="info-toggle" onclick="toggleInfo()">
            <span>ℹ️</span>
            <span id="toggleText">Environmental Benefits Explained</span>
        </button>
        
        <div class="header">
            <div class="animated-sun">
                <div class="sun-circle"></div>
            </div>
            <h1>VW Solar Dashboard</h1>
            <p>Powered by <a href="https://genergy.co.za" target="_blank" rel="noopener noreferrer" class="genergy-link"><span class="genergy-text">Genergy</span></a> & VW</p>
            <div class="last-updated" id="lastUpdated">Loading...</div>
        </div>
        
        <div id="infoPanel" class="info-panel">
            <h2>🌍 How Environmental Benefits Are Calculated</h2>
            
            <div class="info-section">
                <h3>🌿 Understanding Environmental Impact</h3>
                <div class="calculation-item">
                    <strong>💨 CO₂ Avoided</strong>
                    <p>This represents the amount of carbon dioxide emissions prevented by using solar power instead of conventional grid electricity from fossil fuels.</p>
                    <div class="formula">CO₂ Avoided = Energy (kWh) × 1 kg CO₂/kWh</div>
                </div>
                <div class="calculation-item">
                    <strong>🌳 Trees Equivalent</strong>
                    <p>The number of mature trees that would be needed to absorb the same amount of CO₂ that was avoided through solar generation. Based on trees absorbing approximately 22 kg of CO₂ per year.</p>
                    <div class="formula">Trees = CO₂ Avoided / 22 kg per tree per year</div>
                </div>
                <div class="calculation-item">
                    <strong>🏠 Households Powered</strong>
                    <p>How many years an average household could be powered with this amount of clean energy, based on typical consumption of 3,546.63 kWh per household annually.</p>
                    <div class="formula">Household Years = Energy (kWh) / 3,546.63 kWh/year</div>
                </div>
                <div class="calculation-item">
                    <strong>🚗 Driving Equivalent</strong>
                    <p>The distance you could drive an average gasoline car that would produce the same CO₂ emissions as the clean electricity generated by our solar panels.</p>
                    <div class="formula">Distance = CO₂ Avoided / 0.251 kg CO₂ per km</div>
                </div>
                <div class="calculation-item">
                    <strong>✈️ Flying Equivalent</strong>
                    <p>The distance you could fly in a commercial airplane that would emit the same amount of CO₂ as the fossil fuel electricity we've avoided using.</p>
                    <div class="formula">Distance = CO₂ Avoided / 12.28 kg CO₂ per km</div>
                </div>
                <div class="calculation-item">
                    <strong>⚫ Coal Saved</strong>
                    <p>The amount of coal that would need to be burned in a power plant to generate the same amount of electricity we've produced with solar energy.</p>
                    <div class="formula">Coal Saved = Energy (kWh) × 0.508 kg coal per kWh</div>
                </div>
                <div class="calculation-item">
                    <strong>💧 Water Saved</strong>
                    <p>The amount of water saved by using solar power instead of conventional power plants, which require significant amounts of water for cooling systems.</p>
                    <div class="formula">Water Saved = Energy (kWh) × 1.4 litres per kWh</div>
                </div>
            </div>
            
            <div class="info-section">
                <h3>📊 Why These Metrics Matter</h3>
                <div class="calculation-item">
                    <strong>Real Environmental Impact</strong>
                    <p>Every kilowatt-hour of solar energy we generate directly reduces our dependence on fossil fuels and helps combat climate change. These calculations translate abstract energy numbers into tangible environmental benefits that everyone can understand.</p>
                </div>
                <div class="calculation-item">
                    <strong>Data Transparency</strong>
                    <p>All calculations use internationally recognized conversion factors and are updated in real-time based on actual solar production data from our monitoring system.</p>
                </div>
            </div>
        </div>
        
        <div id="loading" class="loading">Loading solar data...</div>
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="content" style="display: none;">
            <div class="grid">
                <div class="card">
                    <div class="card-title">📅 Yesterday's Total</div>
                    <div class="card-value">
                        <span class="value-number" id="yesterdayTotal">0</span><span class="value-unit">kWh</span>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">📅 Today's Total</div>
                    <div class="card-value">
                        <span class="value-number" id="dailyTotal">0</span><span class="value-unit">kWh</span>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">📆 This Month</div>
                    <div class="card-value">
                        <span class="value-number" id="monthlyTotal">0</span><span class="value-unit">kWh</span>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">☀️ Lifetime Total</div>
                    <div class="card-value">
                        <span class="value-number" id="lifetimeTotal">0</span><span class="value-unit">kWh</span>
                    </div>
                </div>
            </div>
            
            <div class="env-sections">
                <div class="section" id="selectedDaySection" style="display: none;">
                    <div class="section-title">
                        <span class="section-icon">📅</span>
                        <span id="selectedDayTitle">Selected Day</span>
                    </div>
                    <div class="env-grid" id="selectedDayEnv"></div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <span class="section-icon">📊</span>
                        <span>Yesterday</span>
                    </div>
                    <div class="env-grid" id="yesterdayEnv"></div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <span class="section-icon">📊</span>
                        <span>Today</span>
                    </div>
                    <div class="env-grid" id="dailyEnv"></div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <span class="section-icon">📈</span>
                        <span>This Month</span>
                    </div>
                    <div class="env-grid" id="monthlyEnv"></div>
                </div>
                
                <div class="section">
                    <div class="section-title">
                        <span class="section-icon">☀️</span>
                        <span>Lifetime</span>
                    </div>
                    <div class="env-grid" id="lifetimeEnv"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const DATA_URL = 'VW_Total_KWh_Json.json';
        let fullData = null;
        
        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            const text = document.getElementById('toggleText');
            if (panel.classList.contains('show')) {
                panel.classList.remove('show');
                text.textContent = 'Environmental Benefits Explained';
            } else {
                panel.classList.add('show');
                text.textContent = 'Hide Explanation';
            }
        }
        
        const tooltipDescriptions = {
            'co2': 'Amount of CO₂ emissions prevented by using solar power instead of conventional electricity from the grid.',
            'trees': 'Equivalent number of trees needed to absorb the same amount of CO₂ that was avoided through solar generation.',
            'households': 'Number of years an average household could be powered with this amount of energy.',
            'driven': 'Distance you could drive an average car that would produce the same CO₂ emissions as the electricity generated.',
            'flown': 'Distance you could fly in an airplane that would produce the same CO₂ emissions as the electricity generated.',
            'coal': 'Amount of coal that would need to be burned to generate the same amount of electricity.',
            'water': 'Amount of water saved by using solar power instead of conventional power plants, which require water for cooling.'
        };
        
        function formatNumber(num) {
            const formatted = new Intl.NumberFormat('en-US', {
                maximumFractionDigits: 2
            }).format(num);
            return formatted.replace(/,/g, ' ');
        }
        
        function formatTotalNumber(num) {
            return Math.floor(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }
        
        function getTooltipKey(label) {
            const lower = label.toLowerCase();
            if (lower.includes('co₂') || lower.includes('co2')) return 'co2';
            if (lower.includes('tree')) return 'trees';
            if (lower.includes('household')) return 'households';
            if (lower.includes('driven')) return 'driven';
            if (lower.includes('flown')) return 'flown';
            if (lower.includes('coal')) return 'coal';
            if (lower.includes('water')) return 'water';
            return null;
        }
        
        function createEnvItem(label, value, unit = '') {
            const tooltipKey = getTooltipKey(label);
            const tooltipText = tooltipKey ? tooltipDescriptions[tooltipKey] : '';
            
            return `
                <div class="env-item" data-tooltip="${tooltipText}">
                    <div class="env-item-label">${label}</div>
                    <div class="env-item-value">${formatNumber(value)} ${unit}</div>
                    <div class="progress-bar"></div>
                    ${tooltipText ? `<div class="tooltip">${tooltipText}</div>` : ''}
                </div>
            `;
        }
        
        function displayEnvironmentalData(data, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                ${createEnvItem('💨 CO₂ Avoided', data.co2_avoided_kg, 'kg')}
                ${createEnvItem('🌳 Trees Equivalent', data.trees_planted_lower, 'trees')}
                ${createEnvItem('🏠 Households Powered', data.households_powered, 'years')}
                ${createEnvItem('🚗 km Driven Equivalent', data.km_driven_equivalent, 'km')}
                ${createEnvItem('✈️ km Flown Equivalent', data.km_flown_equivalent, 'km')}
                ${createEnvItem('⚫ Coal Saved', data.coal_saved_kg, 'kg')}
                ${createEnvItem('💧 Water Saved', data.water_saved_litres, 'litres')}
            `;
            
            const items = container.querySelectorAll('.env-item');
            items.forEach(item => {
                const tooltip = item.querySelector('.tooltip');
                if (tooltip) {
                    let timeout;
                    item.addEventListener('mouseenter', () => {
                        timeout = setTimeout(() => {
                            tooltip.classList.add('show');
                        }, 3000);
                    });
                    item.addEventListener('mouseleave', () => {
                        clearTimeout(timeout);
                        tooltip.classList.remove('show');
                    });
                }
            });
        }
        
        function populateDaySelector(data) {
            const select = document.getElementById('daySelect');
            
            select.innerHTML = '<option value="">Choose a day...</option>';
            
            if (data.past_7_days && Array.isArray(data.past_7_days)) {
                const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                
                const historicalDays = [...data.past_7_days]
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(1);
                
                historicalDays.forEach(day => {
                    const date = new Date(day.date);
                    const dayName = days[date.getDay()];
                    const displayDate = date.toLocaleDateString('en-ZA', { 
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit' 
                    });
                    
                    const option = document.createElement('option');
                    option.value = day.date;
                    option.textContent = `${dayName} (${displayDate}) - ${formatTotalNumber(day.total_kwh)} kWh`;
                    select.appendChild(option);
                });
            }
        }
        
        function handleDayChange() {
            const select = document.getElementById('daySelect');
            const selectedDate = select.value;
            const section = document.getElementById('selectedDaySection');
            
            if (!selectedDate || !fullData) {
                section.style.display = 'none';
                return;
            }
            
            if (fullData.past_7_days && Array.isArray(fullData.past_7_days)) {
                const selectedDay = fullData.past_7_days.find(day => day.date === selectedDate);
                
                if (selectedDay) {
                    section.style.display = 'block';
                    const selectedOption = select.options[select.selectedIndex];
                    document.getElementById('selectedDayTitle').textContent = selectedOption.textContent.split(' - ')[0];
                    displayEnvironmentalData(selectedDay.environmental, 'selectedDayEnv');
                    return;
                }
            }
            
            section.style.display = 'none';
        }
        
        async function fetchData() {
            try {
                const response = await fetch(DATA_URL + '?t=' + Date.now());
                if (!response.ok) throw new Error('Failed to fetch data');
                
                const data = await response.json();
                fullData = data;
                
                document.getElementById('yesterdayTotal').textContent = formatTotalNumber(data.yesterday_total_kwh || 0);
                document.getElementById('dailyTotal').textContent = formatTotalNumber(data.daily_total_kwh);
                document.getElementById('monthlyTotal').textContent = formatTotalNumber(data.monthly_total_kwh);
                document.getElementById('lifetimeTotal').textContent = formatTotalNumber(data.lifetime_total_kwh);
                
                if (data.yesterday_environmental) {
                    displayEnvironmentalData(data.yesterday_environmental, 'yesterdayEnv');
                }
                displayEnvironmentalData(data.daily_environmental, 'dailyEnv');
                displayEnvironmentalData(data.monthly_environmental, 'monthlyEnv');
                displayEnvironmentalData(data.lifetime_environmental, 'lifetimeEnv');
                
                populateDaySelector(data);
                
                const updateTime = new Date(data.timestamp);
                document.getElementById('lastUpdated').textContent = 
                    `Last updated: ${updateTime.toLocaleString()}`;
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').textContent = 
                    'Unable to load solar data. Retrying...';
                document.getElementById('error').style.display = 'block';
            }
        }
        
        fetchData();
        setInterval(fetchData, 60000);
    </script>
</body>
</html>