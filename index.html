<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VW Solar Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f0f0f;
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }
        
        .animated-sun {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .sun-circle {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 30%, #FFE135, #FFB81C);
            border-radius: 50%;
            position: absolute;
            animation: float 8s ease-in-out infinite;
            box-shadow: 0 0 50px rgba(255, 225, 53, 0.6);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }
        
        .header h1 {
            font-size: 2.8em;
            margin-bottom: 5px;
            color: #ffffff;
        }
        
        .header p {
            font-size: 1.8em;
            color: #888;
            font-weight: 300;
            letter-spacing: 1px;
            position: relative;
            display: inline-block;
            margin-top: 10px;
        }
        
        .genergy-link {
            text-decoration: none;
            color: inherit;
            cursor: pointer;
        }
        
        .genergy-text {
            background: linear-gradient(90deg, #666 0%, #666 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            font-weight: 500;
        }
        
        .genergy-text::before {
            content: 'Genergy';
            position: absolute;
            left: 0;
            top: 0;
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            width: 0%;
            overflow: hidden;
            animation: blueSweep 6s ease-in-out infinite;
            filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.4));
        }
        
        @keyframes blueSweep {
            0%, 100% { width: 0%; }
            50% { width: 100%; }
            65% { width: 100%; }
        }
        
        .last-updated {
            font-size: 0.9em;
            color: #666;
            margin-top: 15px;
        }
        
        .info-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px 20px;
            color: #FFD700;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-toggle:hover {
            background: #222;
            border-color: #FFD700;
            transform: translateY(-2px);
        }
        
        .past-7-days-selector {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px 20px;
            color: #FFD700;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .past-7-days-selector:hover {
            background: #222;
            border-color: #FFD700;
            transform: translateY(-2px);
        }
        
        .days-dropdown {
            position: absolute;
            top: calc(100% + 10px);
            left: 0;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 10px 0;
            display: none;
            min-width: 200px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        
        .days-dropdown.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        .day-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.2s ease;
            color: #fff;
        }
        
        .day-item:hover {
            background: #222;
        }
        
        .info-panel {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            display: none;
            animation: slideDown 0.3s ease;
        }
        
        .info-panel.show {
            display: block;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .info-panel h2 {
            color: #FFD700;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #FFD700;
            padding-bottom: 10px;
        }
        
        .info-section {
            margin-bottom: 25px;
        }
        
        .info-section h3 {
            color: #FFA500;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .calculation-item {
            background: #0f0f0f;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 3px solid #FFD700;
        }
        
        .calculation-item strong {
            color: #FFD700;
            display: block;
            margin-bottom: 8px;
            font-size: 1.05em;
        }
        
        .calculation-item p {
            color: #aaa;
            line-height: 1.6;
            margin-bottom: 8px;
        }
        
        .formula {
            background: #1a1a1a;
            padding: 10px 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            color: #4ade80;
            margin-top: 8px;
            border: 1px solid #2a2a2a;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .period-card {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #333;
            transition: all 0.3s ease;
        }
        
        .period-card:hover {
            background: #222;
            border-color: #555;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 165, 0, 0.1);
        }
        
        .period-title {
            font-size: 1.3em;
            color: #FFD700;
            margin-bottom: 20px;
            font-weight: 600;
            border-bottom: 2px solid #FFD700;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .total-kwh {
            font-size: 2.2em;
            font-weight: 700;
            color: #FFD700;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .total-kwh .unit {
            font-size: 0.5em;
            margin-left: 5px;
        }
        
        .env-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .env-item {
            padding: 12px;
            background: #0f0f0f;
            border-radius: 8px;
            border-left: 3px solid #FFD700;
            transition: all 0.3s ease;
            cursor: help;
            position: relative;
        }
        
        .env-item:hover {
            background: #1a1a1a;
            border-left-color: #FFA500;
        }
        
        .env-item-label {
            font-size: 0.8em;
            color: #888;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .env-item-value {
            font-size: 1.2em;
            font-weight: 700;
            color: #FFD700;
        }
        
        .tooltip {
            position: absolute;
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%) scale(0.8);
            background: #2a2a2a;
            color: #fff;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.85em;
            line-height: 1.4;
            width: 280px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 1000;
            border: 1px solid #444;
        }
        
        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #2a2a2a;
        }
        
        .tooltip.show {
            opacity: 1;
            transform: translateX(-50%) scale(1);
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #888;
            font-size: 1.2em;
        }
        
        .error {
            background: #2a1a1a;
            color: #ff6b6b;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
            border: 1px solid #5a2a2a;
        }
        
        @media (max-width: 768px) {
            .info-toggle, .past-7-days-selector {
                position: static;
                margin: 0 auto 10px;
                width: fit-content;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .header p {
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="past-7-days-selector" onclick="toggleDaysDropdown()">
            <span>üìä</span>
            <span>Past 7 Days</span>
            <div class="days-dropdown" id="daysDropdown">
                <div class="day-item" onclick="selectDay(event, -2)">2 days ago</div>
                <div class="day-item" onclick="selectDay(event, -3)">3 days ago</div>
                <div class="day-item" onclick="selectDay(event, -4)">4 days ago</div>
                <div class="day-item" onclick="selectDay(event, -5)">5 days ago</div>
                <div class="day-item" onclick="selectDay(event, -6)">6 days ago</div>
                <div class="day-item" onclick="selectDay(event, -7)">7 days ago</div>
            </div>
        </div>
        
        <button class="info-toggle" onclick="toggleInfo()">
            <span>‚ÑπÔ∏è</span>
            <span id="toggleText">Environmental Benefits Explained</span>
        </button>
        
        <div class="header">
            <div class="animated-sun">
                <div class="sun-circle"></div>
            </div>
            <h1>VW Solar Dashboard</h1>
            <p>Powered by <a href="https://genergy.co.za" target="_blank" rel="noopener noreferrer" class="genergy-link"><span class="genergy-text">Genergy</span></a> & VW</p>
            <div class="last-updated" id="lastUpdated">Loading...</div>
        </div>
        
        <div id="infoPanel" class="info-panel">
            <h2>üåç How Environmental Benefits Are Calculated</h2>
            
            <div class="info-section">
                <h3>üåø Understanding Environmental Impact</h3>
                <div class="calculation-item">
                    <strong>üí® CO‚ÇÇ Avoided</strong>
                    <p>This represents the amount of carbon dioxide emissions prevented by using solar power instead of conventional grid electricity from fossil fuels.</p>
                    <div class="formula">CO‚ÇÇ Avoided = Energy (kWh) √ó 1 kg CO‚ÇÇ/kWh</div>
                </div>
                <div class="calculation-item">
                    <strong>üå≥ Trees Equivalent</strong>
                    <p>The number of mature trees that would be needed to absorb the same amount of CO‚ÇÇ that was avoided through solar generation. Based on trees absorbing approximately 22 kg of CO‚ÇÇ per year.</p>
                    <div class="formula">Trees = CO‚ÇÇ Avoided / 22 kg per tree per year</div>
                </div>
                <div class="calculation-item">
                    <strong>üè† Households Powered</strong>
                    <p>How many years an average household could be powered with this amount of clean energy, based on typical consumption of 3,546.63 kWh per household annually.</p>
                    <div class="formula">Household Years = Energy (kWh) / 3,546.63 kWh/year</div>
                </div>
                <div class="calculation-item">
                    <strong>üöó Driving Equivalent</strong>
                    <p>The distance you could drive an average gasoline car that would produce the same CO‚ÇÇ emissions as the clean electricity generated by our solar panels.</p>
                    <div class="formula">Distance = CO‚ÇÇ Avoided / 0.251 kg CO‚ÇÇ per km</div>
                </div>
                <div class="calculation-item">
                    <strong>‚úàÔ∏è Flying Equivalent</strong>
                    <p>The distance you could fly in a commercial airplane that would emit the same amount of CO‚ÇÇ as the fossil fuel electricity we've avoided using.</p>
                    <div class="formula">Distance = CO‚ÇÇ Avoided / 12.28 kg CO‚ÇÇ per km</div>
                </div>
                <div class="calculation-item">
                    <strong>‚ö´ Coal Saved</strong>
                    <p>The amount of coal that would need to be burned in a power plant to generate the same amount of electricity we've produced with solar energy.</p>
                    <div class="formula">Coal Saved = Energy (kWh) √ó 0.508 kg coal per kWh</div>
                </div>
                <div class="calculation-item">
                    <strong>üíß Water Saved</strong>
                    <p>The amount of water saved by using solar power instead of conventional power plants, which require significant amounts of water for cooling systems.</p>
                    <div class="formula">Water Saved = Energy (kWh) √ó 1.4 litres per kWh</div>
                </div>
            </div>
        </div>
        
        <div id="loading" class="loading">Loading solar data...</div>
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="content" style="display: none;">
            <div class="main-grid">
                <div class="period-card">
                    <div class="period-title">
                        <span>üìÖ</span>
                        <span>Yesterday</span>
                    </div>
                    <div class="total-kwh">
                        <span id="yesterdayTotal">0</span><span class="unit">kWh</span>
                    </div>
                    <div class="env-list" id="yesterdayEnv"></div>
                </div>
                
                <div class="period-card">
                    <div class="period-title">
                        <span>üìÖ</span>
                        <span>Today</span>
                    </div>
                    <div class="total-kwh">
                        <span id="dailyTotal">0</span><span class="unit">kWh</span>
                    </div>
                    <div class="env-list" id="dailyEnv"></div>
                </div>
                
                <div class="period-card">
                    <div class="period-title">
                        <span>üìÜ</span>
                        <span>This Month</span>
                    </div>
                    <div class="total-kwh">
                        <span id="monthlyTotal">0</span><span class="unit">kWh</span>
                    </div>
                    <div class="env-list" id="monthlyEnv"></div>
                </div>
                
                <div class="period-card">
                    <div class="period-title">
                        <span>‚òÄÔ∏è</span>
                        <span>Lifetime</span>
                    </div>
                    <div class="total-kwh">
                        <span id="lifetimeTotal">0</span><span class="unit">kWh</span>
                    </div>
                    <div class="env-list" id="lifetimeEnv"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const DATA_URL = 'VW_Total_KWh_Json.json';
        let fullData = null;
        
        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            const text = document.getElementById('toggleText');
            if (panel.classList.contains('show')) {
                panel.classList.remove('show');
                text.textContent = 'Environmental Benefits Explained';
            } else {
                panel.classList.add('show');
                text.textContent = 'Hide Explanation';
            }
        }
        
        function toggleDaysDropdown() {
            const dropdown = document.getElementById('daysDropdown');
            dropdown.classList.toggle('show');
        }
        
        function selectDay(event, daysAgo) {
            event.stopPropagation();
            if (!fullData || !fullData.past_7_days) return;
            
            const dayIndex = fullData.past_7_days.length + daysAgo;
            if (dayIndex >= 0 && dayIndex < fullData.past_7_days.length) {
                const dayData = fullData.past_7_days[dayIndex];
                alert(`${dayData.date}\nTotal: ${formatNumber(dayData.total_kwh)} kWh\nCO‚ÇÇ Avoided: ${formatNumber(dayData.environmental.co2_avoided_kg)} kg`);
            }
            
            toggleDaysDropdown();
        }
        
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('daysDropdown');
            const selector = document.querySelector('.past-7-days-selector');
            if (!selector.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });
        
        const tooltipDescriptions = {
            'co2': 'Amount of CO‚ÇÇ emissions prevented by using solar power instead of conventional electricity from the grid.',
            'trees': 'Equivalent number of trees needed to absorb the same amount of CO‚ÇÇ that was avoided through solar generation.',
            'households': 'Number of years an average household could be powered with this amount of energy.',
            'driven': 'Distance you could drive an average car that would produce the same CO‚ÇÇ emissions as the electricity generated.',
            'flown': 'Distance you could fly in an airplane that would produce the same CO‚ÇÇ emissions as the electricity generated.',
            'coal': 'Amount of coal that would need to be burned to generate the same amount of electricity.',
            'water': 'Amount of water saved by using solar power instead of conventional power plants, which require water for cooling.'
        };
        
        function formatNumber(num) {
            const formatted = new Intl.NumberFormat('en-US', {
                maximumFractionDigits: 2
            }).format(num);
            return formatted.replace(/,/g, ' ');
        }
        
        function formatTotalNumber(num) {
            return Math.floor(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }
        
        function getTooltipKey(label) {
            const lower = label.toLowerCase();
            if (lower.includes('co‚ÇÇ') || lower.includes('co2')) return 'co2';
            if (lower.includes('tree')) return 'trees';
            if (lower.includes('household')) return 'households';
            if (lower.includes('driven')) return 'driven';
            if (lower.includes('flown')) return 'flown';
            if (lower.includes('coal')) return 'coal';
            if (lower.includes('water')) return 'water';
            return null;
        }
        
        function createEnvItem(label, value, unit = '') {
            const tooltipKey = getTooltipKey(label);
            const tooltipText = tooltipKey ? tooltipDescriptions[tooltipKey] : '';
            
            return `
                <div class="env-item" data-tooltip="${tooltipText}">
                    <div class="env-item-label">${label}</div>
                    <div class="env-item-value">${formatNumber(value)} ${unit}</div>
                    ${tooltipText ? `<div class="tooltip">${tooltipText}</div>` : ''}
                </div>
            `;
        }
        
        function displayEnvironmentalData(data, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                ${createEnvItem('üí® CO‚ÇÇ Avoided', data.co2_avoided_kg, 'kg')}
                ${createEnvItem('üå≥ Trees Equivalent', data.trees_planted_lower, 'trees')}
                ${createEnvItem('üè† Households Powered', data.households_powered, 'years')}
                ${createEnvItem('üöó km Driven', data.km_driven_equivalent, 'km')}
                ${createEnvItem('‚úàÔ∏è km Flown', data.km_flown_equivalent, 'km')}
                ${createEnvItem('‚ö´ Coal Saved', data.coal_saved_kg, 'kg')}
                ${createEnvItem('üíß Water Saved', data.water_saved_litres, 'litres')}
            `;
            
            const items = container.querySelectorAll('.env-item');
            items.forEach(item => {
                const tooltip = item.querySelector('.tooltip');
                if (tooltip) {
                    let timeout;
                    item.addEventListener('mouseenter', () => {
                        timeout = setTimeout(() => {
                            tooltip.classList.add('show');
                        }, 3000);
                    });
                    item.addEventListener('mouseleave', () => {
                        clearTimeout(timeout);
                        tooltip.classList.remove('show');
                    });
                }
            });
        }
        
        async function fetchData() {
            try {
                const response = await fetch(DATA_URL + '?t=' + Date.now());
                if (!response.ok) throw new Error('Failed to fetch data');
                
                const data = await response.json();
                fullData = data;
                
                document.getElementById('yesterdayTotal').textContent = formatTotalNumber(data.yesterday_total_kwh || 0);
                document.getElementById('dailyTotal').textContent = formatTotalNumber(data.daily_total_kwh);
                document.getElementById('monthlyTotal').textContent = formatTotalNumber(data.monthly_total_kwh);
                document.getElementById('lifetimeTotal').textContent = formatTotalNumber(data.lifetime_total_kwh);
                
                if (data.yesterday_environmental) {
                    displayEnvironmentalData(data.yesterday_environmental, 'yesterdayEnv');
                }
                displayEnvironmentalData(data.daily_environmental, 'dailyEnv');
                displayEnvironmentalData(data.monthly_environmental, 'monthlyEnv');
                displayEnvironmentalData(data.lifetime_environmental, 'lifetimeEnv');
                
                const updateTime = new Date(data.timestamp);
                document.getElementById('lastUpdated').textContent = 
                    `Last updated: ${updateTime.toLocaleString()}`;
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').textContent = 
                    'Unable to load solar data. Retrying...';
                document.getElementById('error').style.display = 'block';
            }
        }
        
        fetchData();
        setInterval(fetchData, 60000);
    </script>
</body>
</html>
